<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ë³µë¦¬ ê³„ì‚°ê¸° (ì›” ìˆ˜ìµë¥  1~2ë°°)</title>

    <!-- âœ… Favicon (SVG data URI) -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23111634'/%3E%3Cpath d='M12 44 L26 30 L36 40 L52 24' fill='none' stroke='%236ee7ff' stroke-width='6' stroke-linecap='round'/%3E%3Ccircle cx='52' cy='24' r='4' fill='%238b5cf6'/%3E%3C/svg%3E"
    />

    <style>
      :root {
        --bg: #0f1226;
        --bg2: #111634;
        --card: rgba(255, 255, 255, 0.08);
        --card-border: rgba(255, 255, 255, 0.15);
        --text: #e9ecf1;
        --muted: #b8c0d4;
        --accent: #6ee7ff;
        --accent-2: #8b5cf6;
        --good: #32d583;
        --warn: #f59e0b;
        --track: rgba(255, 255, 255, 0.2);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 16px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont,
          "Segoe UI", Roboto, "Apple SD Gothic Neo", "Noto Sans KR",
          "Malgun Gothic", sans-serif;
        color: var(--text);
        background: radial-gradient(
            1200px 600px at 10% 10%,
            #1b1f4a 0%,
            transparent 60%
          ),
          radial-gradient(1000px 500px at 90% 20%, #24144b 0%, transparent 60%),
          linear-gradient(180deg, var(--bg) 0%, #0b0e20 100%);
        min-height: 100svh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 32px 16px;
      }

      .wrap {
        width: min(1100px, 100%);
        display: grid;
        grid-template-columns: 1.15fr 1fr;
        gap: 22px;
      }
      @media (max-width: 980px) {
        .wrap {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
      }

      .header {
        padding: 18px 22px;
        border-bottom: 1px solid var(--card-border);
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .header h1 {
        font-size: 18px;
        margin: 0;
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      .grid {
        display: grid;
        gap: 14px;
        grid-template-columns: 1fr 1fr;
      }
      @media (max-width: 680px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      .section {
        padding: 18px 18px 20px;
      }

      label {
        font-size: 12px;
        color: var(--muted);
        display: block;
        margin: 0 0 8px;
        letter-spacing: 0.3px;
      }

      .input {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 12px 14px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .input input[type="number"] {
        width: 100%;
        background: transparent;
        border: 0;
        outline: 0;
        color: var(--text);
        font-size: 16px;
        letter-spacing: 0.2px;
      }
      .suffix {
        color: var(--muted);
        font-size: 13px;
        white-space: nowrap;
      }

      .slider-row {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 14px 14px 10px;
      }
      .slider-top {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 10px;
      }
      .slider-top .value {
        font-variant-numeric: tabular-nums;
        font-weight: 700;
        color: var(--accent);
      }
      input[type="range"] {
        width: 100%;
        -webkit-appearance: none;
        appearance: none;
        height: 6px;
        border-radius: 999px;
        background: linear-gradient(
          to right,
          var(--accent) 50%,
          var(--track) 50%
        );
        outline: none;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: radial-gradient(20px 20px at 30% 30%, #fff, #dff7ff);
        border: 2px solid var(--accent);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.35);
        cursor: pointer;
        margin-top: -8px;
      }
      input[type="range"]::-moz-range-thumb {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: #fff;
        border: 2px solid var(--accent);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.35);
        cursor: pointer;
      }

      .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 4px;
      }
      .btn {
        border: 1px solid var(--card-border);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.12),
          rgba(255, 255, 255, 0.06)
        );
        color: var(--text);
        padding: 10px 14px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
      }
      .btn.primary {
        border-color: transparent;
        background: linear-gradient(90deg, var(--accent-2), var(--accent));
        color: #0c1130;
      }
      .btn.ghost {
        background: transparent;
      }

      /* ê²°ê³¼ ì¹´ë“œ */
      .result-wrap {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
      }
      @media (max-width: 680px) {
        .result-wrap {
          grid-template-columns: 1fr;
        }
      }

      .stat {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 14px;
      }
      .stat small {
        color: var(--muted);
        display: block;
        margin-bottom: 6px;
      }
      .stat .num {
        font-size: 20px;
        font-weight: 800;
        letter-spacing: 0.2px;
      }

      .stat.good .num {
        color: var(--good);
      }
      .stat.warn .num {
        color: var(--warn);
      }

      /* ì˜¤ë¥¸ìª½ ì¹´ë“œ: ì°¨íŠ¸ + ìš”ì•½ */
      .summary {
        padding: 18px;
        display: grid;
        gap: 16px;
      }
      canvas {
        width: 100%;
        height: 260px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 12px;
        border: 1px solid var(--card-border);
      }

      details {
        margin-top: 6px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 10px 12px;
      }
      details[open] {
        padding-bottom: 14px;
      }
      details summary {
        cursor: pointer;
        color: var(--accent);
        font-weight: 700;
        outline: none;
        list-style: none;
      }
      details summary::-webkit-details-marker {
        display: none;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
        font-variant-numeric: tabular-nums;
      }
      th,
      td {
        border-bottom: 1px dashed rgba(255, 255, 255, 0.12);
        padding: 10px 6px;
        text-align: right;
        font-size: 13px;
      }
      th:first-child,
      td:first-child {
        text-align: left;
      }
      th {
        color: var(--muted);
        font-weight: 600;
      }

      /* ğŸ” ê¸°ê°„ ë‹¨ìœ„ í† ê¸€ */
      .seg {
        display: inline-flex;
        gap: 4px;
        padding: 4px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
      }
      .seg button {
        border: 0;
        padding: 6px 12px;
        border-radius: 999px;
        cursor: pointer;
        color: var(--muted);
        background: transparent;
        font-weight: 700;
      }
      .seg button.active {
        color: #0c1130;
        background: linear-gradient(90deg, var(--accent-2), var(--accent));
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <!-- ì™¼ìª½: ì…ë ¥ & ê²°ê³¼ -->
      <div class="card">
        <div class="header">
          <svg
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            aria-hidden="true"
          >
            <path
              d="M4 7h16M4 12h16M4 17h10"
              stroke="url(#g)"
              stroke-width="2"
              stroke-linecap="round"
            />
            <defs>
              <linearGradient
                id="g"
                x1="0"
                x2="24"
                y1="0"
                y2="0"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#8b5cf6" />
                <stop offset="1" stop-color="#6ee7ff" />
              </linearGradient>
            </defs>
          </svg>
          <h1>ë³µë¦¬ ê³„ì‚°ê¸°</h1>
        </div>

        <div class="section">
          <div class="grid">
            <!-- ì´ˆê¸° ìê¸ˆ -->
            <div>
              <label for="initial">ì´ˆê¸° ìê¸ˆ</label>
              <div class="input">
                <input
                  id="initial"
                  type="number"
                  min="0"
                  step="1000"
                  value="5000000"
                  aria-label="ì´ˆê¸° ìê¸ˆ(ì›)"
                />
                <span class="suffix">ì›</span>
              </div>
            </div>

            <!-- ì›” íˆ¬ìê¸ˆì•¡ -->
            <div>
              <label for="monthly">ì›” íˆ¬ìê¸ˆì•¡</label>
              <div class="input">
                <input
                  id="monthly"
                  type="number"
                  min="0"
                  step="1000"
                  value="500000"
                  aria-label="ì›” íˆ¬ìê¸ˆì•¡(ì›)"
                />
                <span class="suffix">ì›/ì›”</span>
              </div>
            </div>

            <!-- ì›” ìˆ˜ìµë¥  (ë°°ìˆ˜) -->
            <div style="grid-column: 1 / -1">
              <label for="rate">ì›” ìˆ˜ìµë¥  (ë°°ìˆ˜ 1.00x ~ 2.00x)</label>
              <div class="slider-row">
                <div class="slider-top">
                  <div class="muted">ìŠ¬ë¼ì´ë”ë¡œ ì¡°ì ˆí•˜ì„¸ìš”</div>
                  <div class="value">
                    <span id="rateX">1.02x</span>
                    <span style="color: var(--muted); font-weight: 600"
                      >(â‰ˆ <span id="ratePct">2%</span>)</span
                    >
                  </div>
                </div>
                <input
                  id="rate"
                  type="range"
                  min="1"
                  max="2"
                  step="0.01"
                  value="1.02"
                />
              </div>
            </div>

            <!-- ê¸°ê°„ + ë‹¨ìœ„ í† ê¸€ -->
            <div>
              <label id="periodLabel" for="periodValue">ê¸°ê°„ (ê°œì›”)</label>
              <div class="input">
                <input
                  id="periodValue"
                  type="number"
                  min="1"
                  step="1"
                  value="60"
                  aria-label="ê¸°ê°„"
                />
                <span class="suffix" id="periodSuffix">ê°œì›”</span>
              </div>
            </div>
            <div style="align-self: end">
              <label>ë‹¨ìœ„</label>
              <div class="seg" role="tablist" aria-label="ê¸°ê°„ ë‹¨ìœ„ ì„ íƒ">
                <button
                  type="button"
                  class="active"
                  data-unit="months"
                  role="tab"
                  aria-selected="true"
                >
                  ê°œì›”
                </button>
                <button
                  type="button"
                  data-unit="years"
                  role="tab"
                  aria-selected="false"
                >
                  ë…„
                </button>
              </div>
            </div>

            <!-- ì•¡ì…˜ -->
            <div class="actions" style="grid-column: 1 / -1">
              <button class="btn primary" id="run">ê³„ì‚°í•˜ê¸°</button>
              <button class="btn ghost" id="reset">ì´ˆê¸°í™”</button>
            </div>
          </div>

          <div style="height: 12px"></div>

          <!-- ê²°ê³¼ ìš”ì•½ -->
          <div class="result-wrap">
            <div class="stat">
              <div>
                <small>ìµœì¢… ì”ì•¡</small>
                <div class="num" id="finalBalance">-</div>
              </div>
              <span aria-hidden="true">ğŸ’°</span>
            </div>
            <div class="stat">
              <div>
                <small>ì´ íˆ¬ìì›ê¸ˆ</small>
                <div class="num" id="totalContrib">-</div>
              </div>
              <span aria-hidden="true">ğŸ“¥</span>
            </div>
            <div class="stat good">
              <div>
                <small>ì´ ìˆ˜ìµ</small>
                <div class="num" id="totalGain">-</div>
              </div>
              <span aria-hidden="true">ğŸ“ˆ</span>
            </div>
            <div class="stat warn">
              <div>
                <small>ì›ê¸ˆëŒ€ë¹„ ìˆ˜ìµë¥ </small>
                <div class="num" id="roiPct">-</div>
              </div>
              <span aria-hidden="true">ğŸ§®</span>
            </div>
          </div>

          <details id="tableWrap">
            <summary>ì›”ë³„ ë‚´ì—­ ë³´ê¸°</summary>
            <div style="overflow: auto">
              <table id="schedule">
                <thead>
                  <tr>
                    <th>ì›”</th>
                    <th>ì›” íˆ¬ìê¸ˆ</th>
                    <th>ì ìš© ë°°ìˆ˜</th>
                    <th>ì›”ë§ ì”ì•¡</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </details>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ì°¨íŠ¸ & ë©”ëª¨ -->
      <div class="card summary">
        <div>
          <label>ì”ì•¡ ì¶”ì´</label>
          <canvas
            id="chart"
            width="800"
            height="260"
            aria-label="ì”ì•¡ ì¶”ì´ ë¼ì¸ ì°¨íŠ¸"
          ></canvas>
        </div>
        <div>
          <label>ê³„ì‚° ë°©ì‹</label>
          <div style="font-size: 13px; color: var(--muted); line-height: 1.6">
            ë§¤ì›” <b>ì›” íˆ¬ìê¸ˆ</b>ì„ ê¸°ì¡´ ì”ì•¡ì— ë”í•œ ë’¤, ì„¤ì •í•œ
            <b>ì›” ìˆ˜ìµë¥  ë°°ìˆ˜</b>ë¥¼ ì ìš©í•©ë‹ˆë‹¤.<br />
            ìˆ˜ì‹: <code>(ì”ì•¡ + ì›” íˆ¬ìê¸ˆ) Ã— ì›” ìˆ˜ìµë¥ (ë°°ìˆ˜)</code> ë¥¼
            ê¸°ê°„(ê°œì›”)ë§Œí¼ ë°˜ë³µ.
          </div>
        </div>
      </div>
    </div>

    <script>
      const el = (id) => document.getElementById(id);

      // ë§Œì§„ë²• ë‹¨ìœ„
      const BASE = 10_000;
      // ê¸ˆì•¡ ë‹¨ìœ„(ë§Œì›ì„ ìµœí•˜ìœ„ë¡œ)
      const MONEY_UNITS = [
        "ë§Œì›",
        "ì–µ",
        "ì¡°",
        "ê²½",
        "í•´",
        "ì",
        "ì–‘",
        "êµ¬",
        "ê°„",
        "ì •",
      ];
      // í¼ì„¼íŠ¸ ë‹¨ìœ„(%ë¥¼ ìµœí•˜ìœ„ë¡œ)
      const PCT_UNITS = [
        "%",
        "ë§Œ%",
        "ì–µ%",
        "ì¡°%",
        "ê²½%",
        "í•´%",
        "ì%",
        "ì–‘%",
        "êµ¬%",
        "ê°„%",
        "ì •%",
      ];

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // ê³µí†µ: ì •ìˆ˜ê°’ì„ 10000ì§„ ìë¦¿ìˆ˜ ë°°ì—´ë¡œ (LSBâ†’MSB) ë³€í™˜
      function toBaseDigits(intVal) {
        const digits = [];
        let v = Math.max(0, Math.trunc(intVal));
        if (v === 0) return [0];
        while (v > 0) {
          digits.push(v % BASE);
          v = Math.floor(v / BASE);
        }
        return digits;
      }

      // ê³µí†µ: ìƒìœ„ 2ë‹¨ìœ„ë§Œ ë‚¨ê¸°ê³  ê·¸ ì´í•˜ëŠ” HALF-UP ë°˜ì˜¬ë¦¼
      // digits: LSBâ†’MSB, ë°˜í™˜: ë°˜ì˜¬ë¦¼ëœ ìƒˆ digits
      function roundKeepTwoUnits(digits) {
        let h = digits.length - 1;
        while (h > 0 && digits[h] === 0) h--; // ìµœìƒìœ„ ë¹„ì˜ ìë¦¿ìˆ˜
        const s = Math.max(0, h - 1); // ë‘ ë²ˆì§¸ ìë¦¿ìˆ˜(í•­ìƒ h-1 ê¸°ì¤€)

        if (s > 0) {
          const below = digits[s - 1];
          let carry = false;
          if (below > BASE / 2) carry = true;
          else if (below === BASE / 2) {
            // ì •í™•íˆ ì ˆë°˜ì´ë©´ ë” ì•„ë˜ ìë¦¿ìˆ˜ì— ê°’ ìˆìœ¼ë©´ ì˜¬ë¦¼ (ê´€ìš© half-up)
            let anyLower = false;
            for (let k = 0; k <= s - 2; k++) {
              if (digits[k] !== 0) {
                anyLower = true;
                break;
              }
            }
            carry = true || anyLower;
          }
          for (let k = 0; k < s; k++) digits[k] = 0; // s ì•„ë˜ëŠ” ì ˆì‚¬
          if (carry) {
            digits[s] += 1;
            // ìë¦¬ì˜¬ë¦¼ ì „íŒŒ
            let i = s;
            while (digits[i] >= BASE) {
              digits[i] = 0;
              i++;
              if (i >= digits.length) {
                digits.push(1);
                break;
              } else {
                digits[i] += 1;
              }
            }
          }
        }
        return digits;
      }

      // ê³µí†µ: ë°˜ì˜¬ë¦¼ëœ digitsë¥¼ ìƒìœ„ 2ë‹¨ìœ„ ë¬¸ìì—´ë¡œ êµ¬ì„±
      function joinTwoUnits(digits, UNITS) {
        let h = digits.length - 1;
        while (h > 0 && digits[h] === 0) h--;
        const s = Math.max(0, h - 1);

        const parts = [];
        parts.push(`${digits[h]}${UNITS[h]}`);
        if (s !== h && digits[s] > 0) parts.push(`${digits[s]}${UNITS[s]}`);
        return parts.join(" ");
      }

      // âœ… ê¸ˆì•¡ í¬ë§·: "xxxxì¡° xxxxë§Œ" (ë‘ ë‹¨ìœ„, ë§Œì› ì´í•˜ëŠ” ë°˜ì˜¬ë¦¼)
      function fmtKRW(n) {
        const neg = n < 0;
        const manTotal = Math.round(Math.abs(n) / 10_000); // ë§Œì› ë‹¨ìœ„ ë°˜ì˜¬ë¦¼
        if (manTotal === 0) return "0ì›";
        const digits = roundKeepTwoUnits(toBaseDigits(manTotal));
        const out = joinTwoUnits(digits, MONEY_UNITS);
        return (neg ? "-" : "") + out;
      }

      // âœ… í¼ì„¼íŠ¸ í¬ë§·: ê¸ˆì•¡ì²˜ëŸ¼ ì–µ/ì¡°/ê²½/â€¦ ë‹¨ìœ„ ì§€ì› (ë‘ ë‹¨ìœ„, %ëŠ” ìµœí•˜ìœ„)
      // ì˜ˆ) 12,345.4% â†’ "1ë§Œ 2345%"; 1,2345,6789% â†’ "1ì–µ 2345ë§Œ%"; 99.6% â†’ "100%"
      function fmtPercentBigUnits(p, { showSign = false } = {}) {
        if (!isFinite(p) || p === 0) {
          return showSign ? "+0%" : "0%";
        }
        const sign = p < 0 ? "-" : showSign ? "+" : "";
        const pctInt = Math.round(Math.abs(p)); // % ì´í•˜ ë°˜ì˜¬ë¦¼ â†’ ì •ìˆ˜ %
        const digits = roundKeepTwoUnits(toBaseDigits(pctInt));
        const out = joinTwoUnits(digits, PCT_UNITS);
        return sign + out;
      }

      const $initial = el("initial");
      const $monthly = el("monthly");
      const $rate = el("rate");
      const $run = el("run");
      const $reset = el("reset");

      const $rateX = el("rateX");
      const $ratePct = el("ratePct");

      const $finalBalance = el("finalBalance");
      const $totalContrib = el("totalContrib");
      const $totalGain = el("totalGain");
      const $roiPct = el("roiPct");

      const $tableBody = document.querySelector("#schedule tbody");
      const $tableWrap = el("tableWrap");
      const $chart = el("chart");
      const ctx = $chart.getContext("2d");

      // ğŸ” ê¸°ê°„ ê´€ë ¨ ìš”ì†Œ
      const $periodLabel = el("periodLabel");
      const $periodValue = el("periodValue");
      const $periodSuffix = el("periodSuffix");
      const $unitBtns = document.querySelectorAll("[data-unit]");
      let periodUnit = "months"; // 'months' | 'years'

      // ìŠ¬ë¼ì´ë” ì§„í–‰ë„ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
      function paintSlider(slider) {
        const min = parseFloat(slider.min),
          max = parseFloat(slider.max),
          val = parseFloat(slider.value);
        const pct = ((val - min) / (max - min)) * 100;
        slider.style.background = `linear-gradient(to right, var(--accent) ${pct}%, var(--track) ${pct}%)`;
      }

      function updateRateDisplay() {
        const rate = parseFloat($rate.value);
        $rateX.textContent = rate.toFixed(2) + "x";
        // (rate-1)*100 ì€ 0~100% ë²”ìœ„ì´ì§€ë§Œ, í° ê°’ì—ë„ ëŒ€ì‘í•˜ë„ë¡ ë™ì¼ í¬ë§· ì‚¬ìš©
        $ratePct.textContent = fmtPercentBigUnits((rate - 1) * 100, {
          showSign: false,
        });
        paintSlider($rate);
      }

      // ğŸ” ë‹¨ìœ„ í† ê¸€ UI/ê°’ ë™ê¸°í™”
      function setPeriodUnit(next) {
        if (next === periodUnit) return;

        // í˜„ì¬ ì…ë ¥ê°’ ê¸°ì¤€ ë³€í™˜
        const v = Math.max(1, Math.floor(+$periodValue.value || 1));

        if (next === "years" && periodUnit === "months") {
          const years = Math.max(1, Math.round(v / 12));
          $periodValue.value = years;
        } else if (next === "months" && periodUnit === "years") {
          const months = Math.max(1, v * 12);
          $periodValue.value = months;
        }

        periodUnit = next;
        // ë¼ë²¨/ì ‘ë¯¸ì‚¬
        $periodLabel.textContent =
          periodUnit === "months" ? "ê¸°ê°„ (ê°œì›”)" : "ê¸°ê°„ (ë…„)";
        $periodSuffix.textContent = periodUnit === "months" ? "ê°œì›”" : "ë…„";

        // ì ‘ê·¼ì„± & í™œì„± ë²„íŠ¼
        $unitBtns.forEach((btn) => {
          const active = btn.dataset.unit === periodUnit;
          btn.classList.toggle("active", active);
          btn.setAttribute("aria-selected", active ? "true" : "false");
        });

        compute();
      }

      function getMonthsFromInput() {
        const v = Math.max(1, Math.floor(+$periodValue.value || 1));
        return periodUnit === "months" ? v : v * 12;
      }

      function compute() {
        const initial = Math.max(0, +$initial.value || 0);
        const monthly = Math.max(0, +$monthly.value || 0);
        const factor = Math.min(2, Math.max(1, +$rate.value || 1));
        const months = Math.max(1, Math.floor(getMonthsFromInput()));

        let bal = initial;
        const series = [bal]; // ì‹œì‘ ì‹œì  í¬í•¨(ì›” 0)
        const rows = [];

        for (let m = 1; m <= months; m++) {
          bal = (bal + monthly) * factor; // (ì”ì•¡ + íˆ¬ìê¸ˆ) í›„ ë°°ìˆ˜ ì ìš©
          series.push(bal);
          rows.push({ month: m, invest: monthly, factor, end: bal });
        }

        // ìš”ì•½ ìˆ˜ì¹˜
        const totalContrib = initial + monthly * months;
        const finalBal = bal;
        const totalGain = finalBal - totalContrib;
        const roi = totalContrib > 0 ? (finalBal / totalContrib - 1) * 100 : 0;

        $finalBalance.textContent = fmtKRW(finalBal);
        $totalContrib.textContent = fmtKRW(totalContrib);
        $totalGain.textContent =
          (totalGain >= 0 ? "+" : "-") + fmtKRW(Math.abs(totalGain));
        $roiPct.textContent = fmtPercentBigUnits(roi, { showSign: true });

        // í‘œ ë Œë” (ìµœëŒ€ 1200í–‰ ì•ˆì „)
        renderTable(rows.slice(0, 1200));

        // ì°¨íŠ¸ ë Œë”
        drawLine(series);

        return { series, rows };
      }

      function renderTable(rows) {
        $tableBody.innerHTML = "";
        const frag = document.createDocumentFragment();
        for (const r of rows) {
          const tr = document.createElement("tr");
          const td1 = document.createElement("td");
          td1.textContent = r.month + "ê°œì›”";
          const td2 = document.createElement("td");
          td2.textContent = fmtKRW(r.invest);
          const td3 = document.createElement("td");
          td3.textContent = r.factor.toFixed(2) + "x";
          const td4 = document.createElement("td");
          td4.textContent = fmtKRW(r.end);
          tr.append(td1, td2, td3, td4);
          frag.appendChild(tr);
        }
        $tableBody.appendChild(frag);
      }

      function drawLine(series) {
        // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
        const w = $chart.width,
          h = $chart.height;
        const ctx = $chart.getContext("2d");
        ctx.clearRect(0, 0, w, h);

        // íŒ¨ë”©
        const padL = 50,
          padR = 8,
          padT = 16,
          padB = 28;

        const xs = series.map((_, i) => i);
        const ys = series.map((v) => v);

        const xMin = 0,
          xMax = xs.length - 1 || 1;
        const yMin = 0;
        const yMax = Math.max(...ys.filter(Number.isFinite)) * 1.05 || 1;

        const xScale = (x) =>
          padL + ((x - xMin) / (xMax - xMin)) * (w - padL - padR);
        const yScale = (y) =>
          h - padB - ((y - yMin) / (yMax - yMin)) * (h - padT - padB);

        // ì¶•
        ctx.lineWidth = 1;
        ctx.strokeStyle = "rgba(255,255,255,.25)";
        ctx.beginPath();
        // x-axis
        ctx.moveTo(padL, h - padB);
        ctx.lineTo(w - padR, h - padB);
        // y-axis
        ctx.moveTo(padL, h - padB);
        ctx.lineTo(padL, padT);
        ctx.stroke();

        // yì¶• ë¼ë²¨ 4ê°œ
        ctx.fillStyle = "rgba(255,255,255,.55)";
        ctx.font =
          "12px system-ui, -apple-system, Segoe UI, Roboto, sans-serif";
        const ticks = 4;
        for (let i = 0; i <= ticks; i++) {
          const t = i / ticks;
          const yVal = yMin + t * (yMax - yMin);
          const y = yScale(yVal);
          ctx.fillText(shortKRW(yVal), 6, y + 4);
          ctx.strokeStyle = "rgba(255,255,255,.08)";
          ctx.beginPath();
          ctx.moveTo(padL, y);
          ctx.lineTo(w - padR, y);
          ctx.stroke();
        }

        // ë¼ì¸
        ctx.lineWidth = 2;
        const grad = ctx.createLinearGradient(0, 0, w, 0);
        grad.addColorStop(0, "#8b5cf6");
        grad.addColorStop(1, "#6ee7ff");
        ctx.strokeStyle = grad;
        ctx.beginPath();
        xs.forEach((xVal, i) => {
          const x = xScale(xVal);
          const y = yScale(ys[i]);
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();

        // ë§ˆì§€ë§‰ ì  ê°•ì¡°
        const lastX = xScale(xMax);
        const lastY = yScale(ys[ys.length - 1]);
        ctx.fillStyle = "#6ee7ff";
        ctx.beginPath();
        ctx.arc(lastX, lastY, 3, 0, Math.PI * 2);
        ctx.fill();

        // yì¶• ê¸ˆì•¡ ë¼ë²¨ ì¶•ì•½
        function shortKRW(v) {
          const man = Math.round(v / 10_000); // ë§Œì› ë‹¨ìœ„
          if (man === 0) return "0";
          const SHORT = [
            "ë§Œ",
            "ì–µ",
            "ì¡°",
            "ê²½",
            "í•´",
            "ì",
            "ì–‘",
            "êµ¬",
            "ê°„",
            "ì •",
          ];
          let idx = 0,
            val = man;
          while (val >= BASE && idx < SHORT.length - 1) {
            val /= BASE;
            idx++;
          }
          const text =
            val % 1 === 0 ? String(val) : val.toFixed(1).replace(/\.0$/, "");
          return text + SHORT[idx];
        }
      }

      // ì´ë²¤íŠ¸
      [$initial, $monthly, $rate, $periodValue].forEach(($) =>
        $.addEventListener("input", () => {
          updateRateDisplay();
          compute();
        })
      );

      document.querySelectorAll("[data-unit]").forEach((btn) => {
        btn.addEventListener("click", () => setPeriodUnit(btn.dataset.unit));
      });

      $run.addEventListener("click", compute);

      $reset.addEventListener("click", () => {
        // ê¸°ë³¸ê°’ ì´ˆê¸°í™”
        $initial.value = 5000000;
        $monthly.value = 500000;
        $rate.value = 1.02;
        // ê¸°ê°„ì€ "ê°œì›”" ëª¨ë“œ 60ê°œì›”ë¡œ ì´ˆê¸°í™”
        setPeriodUnit("months");
        $periodValue.value = 60;

        updateRateDisplay();
        compute();
        $tableWrap.open = false;
      });

      // ì´ˆê¸° ì‹¤í–‰
      updateRateDisplay();
      compute();
    </script>
  </body>
</html>

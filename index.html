<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Î≥µÎ¶¨ Í≥ÑÏÇ∞Í∏∞ (Ïõî ÏàòÏùµÎ•† 1~2Î∞∞)</title>

    <!-- ‚úÖ Favicon (SVG data URI) -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23111634'/%3E%3Cpath d='M12 44 L26 30 L36 40 L52 24' fill='none' stroke='%236ee7ff' stroke-width='6' stroke-linecap='round'/%3E%3Ccircle cx='52' cy='24' r='4' fill='%238b5cf6'/%3E%3C/svg%3E"
    />

    <style>
      :root {
        --bg: #0f1226;
        --bg2: #111634;
        --card: rgba(255, 255, 255, 0.08);
        --card-border: rgba(255, 255, 255, 0.15);
        --text: #e9ecf1;
        --muted: #b8c0d4;
        --accent: #6ee7ff;
        --accent-2: #8b5cf6;
        --good: #32d583;
        --warn: #f59e0b;
        --track: rgba(255, 255, 255, 0.2);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 16px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont,
          "Segoe UI", Roboto, "Apple SD Gothic Neo", "Noto Sans KR",
          "Malgun Gothic", sans-serif;
        color: var(--text);
        background: radial-gradient(
            1200px 600px at 10% 10%,
            #1b1f4a 0%,
            transparent 60%
          ),
          radial-gradient(1000px 500px at 90% 20%, #24144b 0%, transparent 60%),
          linear-gradient(180deg, var(--bg) 0%, #0b0e20 100%);
        min-height: 100svh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 32px 16px;
      }

      .wrap {
        width: min(1100px, 100%);
        display: grid;
        grid-template-columns: 1.15fr 1fr;
        gap: 22px;
      }
      @media (max-width: 980px) {
        .wrap {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
      }

      .header {
        padding: 18px 22px;
        border-bottom: 1px solid var(--card-border);
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .header h1 {
        font-size: 18px;
        margin: 0;
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      .grid {
        display: grid;
        gap: 14px;
        grid-template-columns: 1fr 1fr;
      }
      @media (max-width: 680px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      .section {
        padding: 18px 18px 20px;
      }

      label {
        font-size: 12px;
        color: var(--muted);
        display: block;
        margin: 0 0 8px;
        letter-spacing: 0.3px;
      }

      .input {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 12px 14px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .input input[type="number"] {
        width: 100%;
        background: transparent;
        border: 0;
        outline: 0;
        color: var(--text);
        font-size: 16px;
        letter-spacing: 0.2px;
      }
      .suffix {
        color: var(--muted);
        font-size: 13px;
        white-space: nowrap;
      }

      .slider-row {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 14px 14px 10px;
      }
      .slider-top {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 10px;
      }
      .slider-top .value {
        font-variant-numeric: tabular-nums;
        font-weight: 700;
        color: var(--accent);
      }
      input[type="range"] {
        width: 100%;
        -webkit-appearance: none;
        appearance: none;
        height: 6px;
        border-radius: 999px;
        background: linear-gradient(
          to right,
          var(--accent) 50%,
          var(--track) 50%
        );
        outline: none;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: radial-gradient(20px 20px at 30% 30%, #fff, #dff7ff);
        border: 2px solid var(--accent);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.35);
        cursor: pointer;
        margin-top: -8px;
      }
      input[type="range"]::-moz-range-thumb {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: #fff;
        border: 2px solid var(--accent);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.35);
        cursor: pointer;
      }

      .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 4px;
      }
      .btn {
        border: 1px solid var(--card-border);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.12),
          rgba(255, 255, 255, 0.06)
        );
        color: var(--text);
        padding: 10px 14px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
      }
      .btn.primary {
        border-color: transparent;
        background: linear-gradient(90deg, var(--accent-2), var(--accent));
        color: #0c1130;
      }
      .btn.ghost {
        background: transparent;
      }

      /* Í≤∞Í≥º Ïπ¥Îìú */
      .result-wrap {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
      }
      @media (max-width: 680px) {
        .result-wrap {
          grid-template-columns: 1fr;
        }
      }

      .stat {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 14px;
      }
      .stat small {
        color: var(--muted);
        display: block;
        margin-bottom: 6px;
      }
      .stat .num {
        font-size: 20px;
        font-weight: 800;
        letter-spacing: 0.2px;
      }

      .stat.good .num {
        color: var(--good);
      }
      .stat.warn .num {
        color: var(--warn);
      }

      /* Ïò§Î•∏Ï™Ω Ïπ¥Îìú: Ï∞®Ìä∏ + ÏöîÏïΩ */
      .summary {
        padding: 18px;
        display: grid;
        gap: 16px;
      }
      canvas {
        width: 100%;
        height: 260px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 12px;
        border: 1px solid var(--card-border);
      }

      details {
        margin-top: 6px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 10px 12px;
      }
      details[open] {
        padding-bottom: 14px;
      }
      details summary {
        cursor: pointer;
        color: var(--accent);
        font-weight: 700;
        outline: none;
        list-style: none;
      }
      details summary::-webkit-details-marker {
        display: none;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
        font-variant-numeric: tabular-nums;
      }
      th,
      td {
        border-bottom: 1px dashed rgba(255, 255, 255, 0.12);
        padding: 10px 6px;
        text-align: right;
        font-size: 13px;
      }
      th:first-child,
      td:first-child {
        text-align: left;
      }
      th {
        color: var(--muted);
        font-weight: 600;
      }

      /* üîÅ Í∏∞Í∞Ñ Îã®ÏúÑ ÌÜ†Í∏Ä */
      .seg {
        display: inline-flex;
        gap: 4px;
        padding: 4px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
      }
      .seg button {
        border: 0;
        padding: 6px 12px;
        border-radius: 999px;
        cursor: pointer;
        color: var(--muted);
        background: transparent;
        font-weight: 700;
      }
      .seg button.active {
        color: #0c1130;
        background: linear-gradient(90deg, var(--accent-2), var(--accent));
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <!-- ÏôºÏ™Ω: ÏûÖÎ†• & Í≤∞Í≥º -->
      <div class="card">
        <div class="header">
          <svg
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            aria-hidden="true"
          >
            <path
              d="M4 7h16M4 12h16M4 17h10"
              stroke="url(#g)"
              stroke-width="2"
              stroke-linecap="round"
            />
            <defs>
              <linearGradient
                id="g"
                x1="0"
                x2="24"
                y1="0"
                y2="0"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#8b5cf6" />
                <stop offset="1" stop-color="#6ee7ff" />
              </linearGradient>
            </defs>
          </svg>
          <h1>Î≥µÎ¶¨ Í≥ÑÏÇ∞Í∏∞</h1>
        </div>

        <div class="section">
          <div class="grid">
            <!-- Ï¥àÍ∏∞ ÏûêÍ∏à -->
            <div>
              <label for="initial">Ï¥àÍ∏∞ ÏûêÍ∏à</label>
              <div class="input">
                <input
                  id="initial"
                  type="number"
                  min="0"
                  step="1000"
                  value="5000000"
                  aria-label="Ï¥àÍ∏∞ ÏûêÍ∏à(Ïõê)"
                />
                <span class="suffix">Ïõê</span>
              </div>
            </div>

            <!-- Ïõî Ìà¨ÏûêÍ∏àÏï° -->
            <div>
              <label for="monthly">Ïõî Ìà¨ÏûêÍ∏àÏï°</label>
              <div class="input">
                <input
                  id="monthly"
                  type="number"
                  min="0"
                  step="1000"
                  value="500000"
                  aria-label="Ïõî Ìà¨ÏûêÍ∏àÏï°(Ïõê)"
                />
                <span class="suffix">Ïõê/Ïõî</span>
              </div>
            </div>

            <!-- Ïõî ÏàòÏùµÎ•† (Î∞∞Ïàò) -->
            <div style="grid-column: 1 / -1">
              <label for="rate">Ïõî ÏàòÏùµÎ•† (Î∞∞Ïàò 1.00x ~ 2.00x)</label>
              <div class="slider-row">
                <div class="slider-top">
                  <div class="muted">Ïä¨ÎùºÏù¥ÎçîÎ°ú Ï°∞Ï†àÌïòÏÑ∏Ïöî</div>
                  <div class="value">
                    <span id="rateX">1.02x</span>
                    <span style="color: var(--muted); font-weight: 600"
                      >(‚âà <span id="ratePct">2%</span>)</span
                    >
                  </div>
                </div>
                <input
                  id="rate"
                  type="range"
                  min="1"
                  max="2"
                  step="0.01"
                  value="1.02"
                />
              </div>
            </div>

            <!-- Í∏∞Í∞Ñ + Îã®ÏúÑ ÌÜ†Í∏Ä -->
            <div>
              <label id="periodLabel" for="periodValue">Í∏∞Í∞Ñ (Í∞úÏõî)</label>
              <div class="input">
                <input
                  id="periodValue"
                  type="number"
                  min="1"
                  step="1"
                  value="60"
                  aria-label="Í∏∞Í∞Ñ"
                />
                <span class="suffix" id="periodSuffix">Í∞úÏõî</span>
              </div>
            </div>
            <div style="align-self: end">
              <label>Îã®ÏúÑ</label>
              <div class="seg" role="tablist" aria-label="Í∏∞Í∞Ñ Îã®ÏúÑ ÏÑ†ÌÉù">
                <button
                  type="button"
                  class="active"
                  data-unit="months"
                  role="tab"
                  aria-selected="true"
                >
                  Í∞úÏõî
                </button>
                <button
                  type="button"
                  data-unit="years"
                  role="tab"
                  aria-selected="false"
                >
                  ÎÖÑ
                </button>
              </div>
            </div>

            <!-- Ïï°ÏÖò -->
            <div class="actions" style="grid-column: 1 / -1">
              <button class="btn primary" id="run">Í≥ÑÏÇ∞ÌïòÍ∏∞</button>
              <button class="btn ghost" id="reset">Ï¥àÍ∏∞Ìôî</button>
            </div>
          </div>

          <div style="height: 12px"></div>

          <!-- Í≤∞Í≥º ÏöîÏïΩ -->
          <div class="result-wrap">
            <div class="stat">
              <div>
                <small>ÏµúÏ¢Ö ÏûîÏï°</small>
                <div class="num" id="finalBalance">-</div>
              </div>
              <span aria-hidden="true">üí∞</span>
            </div>
            <div class="stat">
              <div>
                <small>Ï¥ù Ìà¨ÏûêÏõêÍ∏à</small>
                <div class="num" id="totalContrib">-</div>
              </div>
              <span aria-hidden="true">üì•</span>
            </div>
            <div class="stat good">
              <div>
                <small>Ï¥ù ÏàòÏùµ</small>
                <div class="num" id="totalGain">-</div>
              </div>
              <span aria-hidden="true">üìà</span>
            </div>
            <div class="stat warn">
              <div>
                <small>ÏõêÍ∏àÎåÄÎπÑ ÏàòÏùµÎ•†</small>
                <div class="num" id="roiPct">-</div>
              </div>
              <span aria-hidden="true">üßÆ</span>
            </div>
          </div>

          <details id="tableWrap">
            <summary>ÏõîÎ≥Ñ ÎÇ¥Ïó≠ Î≥¥Í∏∞</summary>
            <div style="overflow: auto">
              <table id="schedule">
                <thead>
                  <tr>
                    <th>Ïõî</th>
                    <th>Ïõî Ìà¨ÏûêÍ∏à</th>
                    <th>Ï†ÅÏö© Î∞∞Ïàò</th>
                    <th>ÏõîÎßê ÏûîÏï°</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </details>
        </div>
      </div>

      <!-- Ïò§Î•∏Ï™Ω: Ï∞®Ìä∏ & Î©îÎ™® -->
      <div class="card summary">
        <div>
          <label>ÏûîÏï° Ï∂îÏù¥</label>
          <canvas
            id="chart"
            width="800"
            height="260"
            aria-label="ÏûîÏï° Ï∂îÏù¥ ÎùºÏù∏ Ï∞®Ìä∏"
          ></canvas>
        </div>
        <div>
          <label>Í≥ÑÏÇ∞ Î∞©Ïãù</label>
          <div style="font-size: 13px; color: var(--muted); line-height: 1.6">
            Îß§Ïõî <b>Ïõî Ìà¨ÏûêÍ∏à</b>ÏùÑ Í∏∞Ï°¥ ÏûîÏï°Ïóê ÎçîÌïú Îí§, ÏÑ§Ï†ïÌïú
            <b>Ïõî ÏàòÏùµÎ•† Î∞∞Ïàò</b>Î•º Ï†ÅÏö©Ìï©ÎãàÎã§.<br />
            ÏàòÏãù: <code>(ÏûîÏï° + Ïõî Ìà¨ÏûêÍ∏à) √ó Ïõî ÏàòÏùµÎ•†(Î∞∞Ïàò)</code> Î•º
            Í∏∞Í∞Ñ(Í∞úÏõî)ÎßåÌÅº Î∞òÎ≥µ.
          </div>
        </div>
      </div>
    </div>

    <script>
      const el = (id) => document.getElementById(id);

      // ÎßåÏßÑÎ≤ï Îã®ÏúÑ
      const BASE = 10_000;
      // Í∏àÏï° Îã®ÏúÑ(ÎßåÏõêÏùÑ ÏµúÌïòÏúÑÎ°ú)
      const MONEY_UNITS = [
        "ÎßåÏõê",
        "Ïñµ",
        "Ï°∞",
        "Í≤Ω",
        "Ìï¥",
        "Ïûê",
        "Ïñë",
        "Íµ¨",
        "Í∞Ñ",
        "Ï†ï",
      ];
      // ÌçºÏÑºÌä∏ Îã®ÏúÑ(%Î•º ÏµúÌïòÏúÑÎ°ú)
      const PCT_UNITS = [
        "%",
        "Îßå%",
        "Ïñµ%",
        "Ï°∞%",
        "Í≤Ω%",
        "Ìï¥%",
        "Ïûê%",
        "Ïñë%",
        "Íµ¨%",
        "Í∞Ñ%",
        "Ï†ï%",
      ];

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      // Í≥µÌÜµ: Ï†ïÏàòÍ∞íÏùÑ 10000ÏßÑ ÏûêÎ¶øÏàò Î∞∞Ïó¥Î°ú (LSB‚ÜíMSB) Î≥ÄÌôò
      function toBaseDigits(intVal) {
        const digits = [];
        let v = Math.max(0, Math.trunc(intVal));
        if (v === 0) return [0];
        while (v > 0) {
          digits.push(v % BASE);
          v = Math.floor(v / BASE);
        }
        return digits;
      }

      // Í≥µÌÜµ: ÏÉÅÏúÑ 2Îã®ÏúÑÎßå ÎÇ®Í∏∞Í≥† Í∑∏ Ïù¥ÌïòÎäî HALF-UP Î∞òÏò¨Î¶º
      // digits: LSB‚ÜíMSB, Î∞òÌôò: Î∞òÏò¨Î¶ºÎêú ÏÉà digits
      function roundKeepTwoUnits(digits) {
        let h = digits.length - 1;
        while (h > 0 && digits[h] === 0) h--; // ÏµúÏÉÅÏúÑ ÎπÑÏòÅ ÏûêÎ¶øÏàò
        const s = Math.max(0, h - 1); // Îëê Î≤àÏß∏ ÏûêÎ¶øÏàò(Ìï≠ÏÉÅ h-1 Í∏∞Ï§Ä)

        if (s > 0) {
          const below = digits[s - 1];
          let carry = false;
          if (below > BASE / 2) carry = true;
          else if (below === BASE / 2) {
            // Ï†ïÌôïÌûà Ï†àÎ∞òÏù¥Î©¥ Îçî ÏïÑÎûò ÏûêÎ¶øÏàòÏóê Í∞í ÏûàÏúºÎ©¥ Ïò¨Î¶º (Í¥ÄÏö© half-up)
            let anyLower = false;
            for (let k = 0; k <= s - 2; k++) {
              if (digits[k] !== 0) {
                anyLower = true;
                break;
              }
            }
            carry = true || anyLower;
          }
          for (let k = 0; k < s; k++) digits[k] = 0; // s ÏïÑÎûòÎäî Ï†àÏÇ¨
          if (carry) {
            digits[s] += 1;
            // ÏûêÎ¶¨Ïò¨Î¶º Ï†ÑÌåå
            let i = s;
            while (digits[i] >= BASE) {
              digits[i] = 0;
              i++;
              if (i >= digits.length) {
                digits.push(1);
                break;
              } else {
                digits[i] += 1;
              }
            }
          }
        }
        return digits;
      }

      // Í≥µÌÜµ: Î∞òÏò¨Î¶ºÎêú digitsÎ•º ÏÉÅÏúÑ 2Îã®ÏúÑ Î¨∏ÏûêÏó¥Î°ú Íµ¨ÏÑ±
      function joinTwoUnits(digits, UNITS) {
        let h = digits.length - 1;
        while (h > 0 && digits[h] === 0) h--;
        const s = Math.max(0, h - 1);

        const parts = [];
        parts.push(`${digits[h]}${UNITS[h]}`);
        if (s !== h && digits[s] > 0) parts.push(`${digits[s]}${UNITS[s]}`);
        return parts.join(" ");
      }

      // ‚úÖ Í∏àÏï° Ìè¨Îß∑: "xxxxÏ°∞ xxxxÎßå" (Îëê Îã®ÏúÑ, ÎßåÏõê Ïù¥ÌïòÎäî Î∞òÏò¨Î¶º)
      function fmtKRW(n) {
        const neg = n < 0;
        const manTotal = Math.round(Math.abs(n) / 10_000); // ÎßåÏõê Îã®ÏúÑ Î∞òÏò¨Î¶º
        if (manTotal === 0) return "0Ïõê";
        const digits = roundKeepTwoUnits(toBaseDigits(manTotal));
        const out = joinTwoUnits(digits, MONEY_UNITS);
        return (neg ? "-" : "") + out;
      }

      // ‚úÖ ÌçºÏÑºÌä∏ Ìè¨Îß∑: Í∏àÏï°Ï≤òÎüº Ïñµ/Ï°∞/Í≤Ω/‚Ä¶ Îã®ÏúÑ ÏßÄÏõê (Îëê Îã®ÏúÑ, %Îäî ÏµúÌïòÏúÑ)
      // Ïòà) 12,345.4% ‚Üí "1Îßå 2345%"; 1,2345,6789% ‚Üí "1Ïñµ 2345Îßå%"; 99.6% ‚Üí "100%"
      function fmtPercentBigUnits(p, { showSign = false } = {}) {
        if (!isFinite(p) || p === 0) {
          return showSign ? "+0%" : "0%";
        }
        const sign = p < 0 ? "-" : showSign ? "+" : "";
        const pctInt = Math.round(Math.abs(p)); // % Ïù¥Ìïò Î∞òÏò¨Î¶º ‚Üí Ï†ïÏàò %
        const digits = roundKeepTwoUnits(toBaseDigits(pctInt));
        const out = joinTwoUnits(digits, PCT_UNITS);
        return sign + out;
      }

      const $initial = el("initial");
      const $monthly = el("monthly");
      const $rate = el("rate");
      const $run = el("run");
      const $reset = el("reset");

      const $rateX = el("rateX");
      const $ratePct = el("ratePct");

      const $finalBalance = el("finalBalance");
      const $totalContrib = el("totalContrib");
      const $totalGain = el("totalGain");
      const $roiPct = el("roiPct");

      const $tableBody = document.querySelector("#schedule tbody");
      const $tableWrap = el("tableWrap");
      const $chart = el("chart");
      const ctx = $chart.getContext("2d");

      // üîÅ Í∏∞Í∞Ñ Í¥ÄÎ†® ÏöîÏÜå
      const $periodLabel = el("periodLabel");
      const $periodValue = el("periodValue");
      const $periodSuffix = el("periodSuffix");
      const $unitBtns = document.querySelectorAll("[data-unit]");
      let periodUnit = "months"; // 'months' | 'years'

      // Ïä¨ÎùºÏù¥Îçî ÏßÑÌñâÎèÑ ÏÉâÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏
      function paintSlider(slider) {
        const min = parseFloat(slider.min),
          max = parseFloat(slider.max),
          val = parseFloat(slider.value);
        const pct = ((val - min) / (max - min)) * 100;
        slider.style.background = `linear-gradient(to right, var(--accent) ${pct}%, var(--track) ${pct}%)`;
      }

      function updateRateDisplay() {
        const rate = parseFloat($rate.value);
        $rateX.textContent = rate.toFixed(2) + "x";
        // (rate-1)*100 ÏùÄ 0~100% Î≤îÏúÑÏù¥ÏßÄÎßå, ÌÅ∞ Í∞íÏóêÎèÑ ÎåÄÏùëÌïòÎèÑÎ°ù ÎèôÏùº Ìè¨Îß∑ ÏÇ¨Ïö©
        $ratePct.textContent = fmtPercentBigUnits((rate - 1) * 100, {
          showSign: false,
        });
        paintSlider($rate);
      }

      // üîÅ Îã®ÏúÑ ÌÜ†Í∏Ä UI/Í∞í ÎèôÍ∏∞Ìôî
      function setPeriodUnit(next) {
        if (next === periodUnit) return;

        // ÌòÑÏû¨ ÏûÖÎ†•Í∞í Í∏∞Ï§Ä Î≥ÄÌôò
        const v = Math.max(1, Math.floor(+$periodValue.value || 1));

        if (next === "years" && periodUnit === "months") {
          const years = Math.max(1, Math.round(v / 12));
          $periodValue.value = years;
        } else if (next === "months" && periodUnit === "years") {
          const months = Math.max(1, v * 12);
          $periodValue.value = months;
        }

        periodUnit = next;
        // ÎùºÎ≤®/Ï†ëÎØ∏ÏÇ¨
        $periodLabel.textContent =
          periodUnit === "months" ? "Í∏∞Í∞Ñ (Í∞úÏõî)" : "Í∏∞Í∞Ñ (ÎÖÑ)";
        $periodSuffix.textContent = periodUnit === "months" ? "Í∞úÏõî" : "ÎÖÑ";

        // Ï†ëÍ∑ºÏÑ± & ÌôúÏÑ± Î≤ÑÌäº
        $unitBtns.forEach((btn) => {
          const active = btn.dataset.unit === periodUnit;
          btn.classList.toggle("active", active);
          btn.setAttribute("aria-selected", active ? "true" : "false");
        });

        compute();
      }

      function getMonthsFromInput() {
        const v = Math.max(1, Math.floor(+$periodValue.value || 1));
        return periodUnit === "months" ? v : v * 12;
      }

      function compute() {
        const initial = Math.max(0, +$initial.value || 0);
        const monthly = Math.max(0, +$monthly.value || 0);
        const factor = Math.min(2, Math.max(1, +$rate.value || 1));
        const months = Math.max(1, Math.floor(getMonthsFromInput()));

        let bal = initial;
        const series = [bal]; // ÏãúÏûë ÏãúÏ†ê Ìè¨Ìï®(Ïõî 0)
        const rows = [];

        for (let m = 1; m <= months; m++) {
          bal = (bal + monthly) * factor; // (ÏûîÏï° + Ìà¨ÏûêÍ∏à) ÌõÑ Î∞∞Ïàò Ï†ÅÏö©
          series.push(bal);
          rows.push({ month: m, invest: monthly, factor, end: bal });
        }

        // ÏöîÏïΩ ÏàòÏπò
        const totalContrib = initial + monthly * months;
        const finalBal = bal;
        const totalGain = finalBal - totalContrib;
        const roi = totalContrib > 0 ? (finalBal / totalContrib - 1) * 100 : 0;

        $finalBalance.textContent = fmtKRW(finalBal);
        $totalContrib.textContent = fmtKRW(totalContrib);
        $totalGain.textContent =
          (totalGain >= 0 ? "+" : "-") + fmtKRW(Math.abs(totalGain));
        $roiPct.textContent = fmtPercentBigUnits(roi, { showSign: true });

        // Ìëú Î†åÎçî (ÏµúÎåÄ 1200Ìñâ ÏïàÏ†Ñ)
        renderTable(rows.slice(0, 1200));

        // Ï∞®Ìä∏ Î†åÎçî
        drawLine(series);

        return { series, rows };
      }

      function renderTable(rows) {
        $tableBody.innerHTML = "";
        const frag = document.createDocumentFragment();
        for (const r of rows) {
          const tr = document.createElement("tr");
          const td1 = document.createElement("td");
          td1.textContent = r.month + "Í∞úÏõî";
          const td2 = document.createElement("td");
          td2.textContent = fmtKRW(r.invest);
          const td3 = document.createElement("td");
          td3.textContent = r.factor.toFixed(2) + "x";
          const td4 = document.createElement("td");
          td4.textContent = fmtKRW(r.end);
          tr.append(td1, td2, td3, td4);
          frag.appendChild(tr);
        }
        $tableBody.appendChild(frag);
      }

      function drawLine(series) {
        // Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
        const w = $chart.width,
          h = $chart.height;
        const ctx = $chart.getContext("2d");
        ctx.clearRect(0, 0, w, h);

        // Ìå®Îî©
        const padL = 50,
          padR = 8,
          padT = 16,
          padB = 28;

        const xs = series.map((_, i) => i);
        const ys = series.map((v) => v);

        const xMin = 0,
          xMax = xs.length - 1 || 1;
        const yMin = 0;
        const yMax = Math.max(...ys.filter(Number.isFinite)) * 1.05 || 1;

        const xScale = (x) =>
          padL + ((x - xMin) / (xMax - xMin)) * (w - padL - padR);
        const yScale = (y) =>
          h - padB - ((y - yMin) / (yMax - yMin)) * (h - padT - padB);

        // Ï∂ï
        ctx.lineWidth = 1;
        ctx.strokeStyle = "rgba(255,255,255,.25)";
        ctx.beginPath();
        // x-axis
        ctx.moveTo(padL, h - padB);
        ctx.lineTo(w - padR, h - padB);
        // y-axis
        ctx.moveTo(padL, h - padB);
        ctx.lineTo(padL, padT);
        ctx.stroke();

        // yÏ∂ï ÎùºÎ≤® 4Í∞ú
        ctx.fillStyle = "rgba(255,255,255,.55)";
        ctx.font =
          "12px system-ui, -apple-system, Segoe UI, Roboto, sans-serif";
        const ticks = 4;
        for (let i = 0; i <= ticks; i++) {
          const t = i / ticks;
          const yVal = yMin + t * (yMax - yMin);
          const y = yScale(yVal);
          ctx.fillText(shortKRW(yVal), 6, y + 4);
          ctx.strokeStyle = "rgba(255,255,255,.08)";
          ctx.beginPath();
          ctx.moveTo(padL, y);
          ctx.lineTo(w - padR, y);
          ctx.stroke();
        }

        // ÎùºÏù∏
        ctx.lineWidth = 2;
        const grad = ctx.createLinearGradient(0, 0, w, 0);
        grad.addColorStop(0, "#8b5cf6");
        grad.addColorStop(1, "#6ee7ff");
        ctx.strokeStyle = grad;
        ctx.beginPath();
        xs.forEach((xVal, i) => {
          const x = xScale(xVal);
          const y = yScale(ys[i]);
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();

        // ÎßàÏßÄÎßâ Ï†ê Í∞ïÏ°∞
        const lastX = xScale(xMax);
        const lastY = yScale(ys[ys.length - 1]);
        ctx.fillStyle = "#6ee7ff";
        ctx.beginPath();
        ctx.arc(lastX, lastY, 3, 0, Math.PI * 2);
        ctx.fill();

        // yÏ∂ï Í∏àÏï° ÎùºÎ≤® Ï∂ïÏïΩ
        function shortKRW(v) {
          const man = Math.round(v / 10_000); // ÎßåÏõê Îã®ÏúÑ
          if (man === 0) return "0";
          const SHORT = [
            "Îßå",
            "Ïñµ",
            "Ï°∞",
            "Í≤Ω",
            "Ìï¥",
            "Ïûê",
            "Ïñë",
            "Íµ¨",
            "Í∞Ñ",
            "Ï†ï",
          ];
          let idx = 0,
            val = man;
          while (val >= BASE && idx < SHORT.length - 1) {
            val /= BASE;
            idx++;
          }
          const text =
            val % 1 === 0 ? String(val) : val.toFixed(1).replace(/\.0$/, "");
          return text + SHORT[idx];
        }
      }

      // Ïù¥Î≤§Ìä∏
      [$initial, $monthly, $rate, $periodValue].forEach(($) =>
        $.addEventListener("input", () => {
          updateRateDisplay();
          compute();
        })
      );

      document.querySelectorAll("[data-unit]").forEach((btn) => {
        btn.addEventListener("click", () => setPeriodUnit(btn.dataset.unit));
      });

      $run.addEventListener("click", compute);

      $reset.addEventListener("click", () => {
        // Í∏∞Î≥∏Í∞í Ï¥àÍ∏∞Ìôî
        $initial.value = 5000000;
        $monthly.value = 500000;
        $rate.value = 1.02;
        // Í∏∞Í∞ÑÏùÄ "Í∞úÏõî" Î™®Îìú 60Í∞úÏõîÎ°ú Ï¥àÍ∏∞Ìôî
        setPeriodUnit("months");
        $periodValue.value = 60;

        updateRateDisplay();
        compute();
        $tableWrap.open = false;
      });

      // Ï¥àÍ∏∞ Ïã§Ìñâ
      updateRateDisplay();
      compute();
    </script>
  </body>
</html>
